<!DOCTYPE html>
<html lang="id">
<head>
    <meta name="google-site-verification" content="pz72A_SOUbG4L7dPVTVI81N2NCn6mhxR7WBHsYVQMho" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>PAI B IAINU Kebumen Official 2025</title>
    
    <meta name="description" content="Website Resmi Kelas PAI B Angkatan 2025 Fakultas Tarbiyah IAINU Kebumen. Galeri, Struktur Organisasi, dan Dokumentasi Kegiatan Mahasiswa.">
    <meta name="keywords" content="PAI B, IAINU Kebumen, Kelas PAI B 2025, Fakultas Tarbiyah, Mahasiswa Kebumen">
    <meta name="theme-color" content="#000000">
    
    <!-- Meta Tags -->
    <meta property="og:site_name" content="PAI B Official IAINU Kebumen">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://paib-official.com/"> 
    <meta property="og:title" content="PAI B Official - IAINU Kebumen">
    <meta property="og:description" content="Website Resmi Keluarga Besar PAI B 2025. One Heart, One Goal.">
    <meta property="og:image" content="PAI B.jpg">

    <link rel="icon" type="image/jpeg" href="PAI B.jpg">
    <link rel="shortcut icon" type="image/jpeg" href="PAI B.jpg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'crimson-dark': '#1a0505',
                        'crimson-main': '#8a0000',
                        'crimson-light': '#ff1f1f',
                        'glass': 'rgba(255, 255, 255, 0.05)',
                        'crimson-glow': '#ff0000', 
                    },
                    fontFamily: {
                        'tech': ['Orbitron', 'sans-serif'],
                        'body': ['Poppins', 'sans-serif'],
                        'saldo': ['"Fira Code"', 'Courier New', 'monospace'], 
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'spin-slow': 'spin 3s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @font-face {
            font-family: 'DS-Digital';
            src: url('DS-DIGII.TTF') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }

        body {
            background-color: #0a0000;
            color: #e5e5e5;
            overflow-x: hidden;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -webkit-user-select: none;
            user-select: none;
            font-family: 'Poppins', sans-serif;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a0505; }
        ::-webkit-scrollbar-thumb { background: #8a0000; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #ff1f1f; }

        .glass-panel {
            background: rgba(40, 0, 0, 0.6);
            border: 1px solid rgba(255, 50, 50, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            transform: translateZ(0); 
            -webkit-transform: translateZ(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .font-saldo-custom { font-family: 'DS-Digital', 'Courier New', monospace; letter-spacing: 2px; }

        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #000000, #2b0000);
            z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column;
            transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
            will-change: transform, opacity;
        }

        #page-loader {
            position: fixed; inset: 0; z-index: 9990; 
            background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out;
        }
        #page-loader.active { opacity: 1; pointer-events: auto; }

        .hidden-section { display: none; opacity: 0; transition: opacity 0.5s ease; }
        .active-section { display: block; animation: fadeIn 0.6s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .typing-cursor::after { content: '|'; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .neon-text { text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000, 0 0 20px #8a0000; }

        /* --- STRUCTURE TREE CSS FIXED --- */
        .tree { display: flex; justify-content: center; margin: 0 auto; min-width: 100%; padding-bottom: 50px; }
        .tree ul { padding-top: 20px; position: relative; transition: all 0.5s; display: flex; justify-content: center; }
        .tree li { float: left; text-align: center; list-style-type: none; position: relative; padding: 20px 5px 0 5px; transition: all 0.5s; }
        .tree li::before, .tree li::after { content: ''; position: absolute; top: 0; right: 50%; border-top: 2px solid #8a0000; width: 50%; height: 20px; }
        .tree li::after { right: auto; left: 50%; border-left: 2px solid #8a0000; }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before{ border-right: 2px solid #8a0000; border-radius: 0 5px 0 0; }
        .tree li:first-child::after{ border-radius: 5px 0 0 0; }
        .tree ul ul::before{ content: ''; position: absolute; top: 0; left: 50%; border-left: 2px solid #8a0000; width: 0; height: 20px; }
        
        #structure-content-container { width: 100%; overflow-x: auto; padding-bottom: 2rem; display: flex; justify-content: center; min-h-[400px]; }

        .fullscreen-overlay {
            position: fixed; inset: 0; width: 100%; height: 100%; z-index: 100; overflow: auto;
            background: rgba(10, 0, 0, 0.95); opacity: 0; pointer-events: none;
            transition: transform 0.3s ease, opacity 0.3s ease; transform: scale(0.9);
            will-change: transform, opacity;
        }
        .fullscreen-overlay.open { transform: scale(1); opacity: 1; pointer-events: auto; }
        
        .custom-modal {
            position: fixed; inset: 0; z-index: 200;
            background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .custom-modal.active { opacity: 1; pointer-events: auto; }

        .edit-modal {
            position: fixed; inset: 0; z-index: 200;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.2s ease;
        }
        .edit-modal.active { opacity: 1; pointer-events: auto; }

        .empty-slot { border: 1px dashed rgba(150, 150, 150, 0.3); background: rgba(20, 0, 0, 0.2); }
        .empty-slot:hover { border-color: #ef4444; border-style: solid; }
        .avatar-glow { box-shadow: 0 0 15px rgba(255, 0, 0, 0.2); transition: 0.3s; }
        .glass-panel:hover .avatar-glow { box-shadow: 0 0 25px rgba(255, 0, 0, 0.6); border-color: #fff; }
        
        .music-pulse { animation: musicPulse 1.5s infinite; }
        @keyframes musicPulse { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }
        .img-loading-skeleton { position: absolute; inset: 0; background-color: #1f2937; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; display: flex; align-items: center; justify-content: center; z-index: 0; }
        .img-loaded { opacity: 1 !important; }
        .play-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: rgba(220, 38, 38, 0.85); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; transition: transform 0.3s, background-color 0.3s; box-shadow: 0 0 25px rgba(220, 38, 38, 0.6); z-index: 10; }
        .group:hover .play-overlay { background: rgba(255, 255, 255, 0.95); color: #dc2626; transform: translate(-50%, -50%) scale(1.15); }
    </style>
</head>
<body class="font-body selection:bg-red-500 selection:text-white" oncontextmenu="return false;" ondragstart="return false;" onselectstart="return false;">

    <audio id="bg-music" loop>
        <source src="Qolbi Fil Madinah.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div id="page-loader">
        <div class="w-16 h-16 border-4 border-red-600 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 text-red-500 font-tech tracking-widest text-sm animate-pulse">MEMUAT...</p>
    </div>

    <div id="intro-screen">
        <div class="text-center">
            <h1 class="font-tech text-4xl md:text-7xl font-bold text-white mb-4 tracking-widest neon-text">
                PRODI <span id="typing-text" class="text-red-500 typing-cursor"></span>
            </h1>
            <p class="text-gray-400 text-sm md:text-lg mb-8 font-light tracking-[0.3em]">2025 | GENERATION OF SUCCESS</p>
            <button onclick="enterSite()" class="group relative px-8 py-3 bg-transparent overflow-hidden rounded-full border border-red-600 transition-all hover:shadow-[0_0_20px_rgba(255,0,0,0.5)]">
                <span class="relative z-10 text-white font-tech tracking-wider group-hover:text-black transition-colors duration-300">VISIT CLASS</span>
                <div class="absolute inset-0 h-full w-full scale-0 rounded-full transition-all duration-300 group-hover:scale-100 group-hover:bg-red-600"></div>
            </button>
        </div>
    </div>

    <div id="main-app" class="hidden opacity-0 transition-opacity duration-1000 min-h-screen flex flex-col">
        <nav class="fixed top-0 w-full z-50 glass-panel border-b border-red-900/30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0 cursor-pointer" onclick="switchTab('home')">
                        <span class="font-tech text-2xl font-bold text-red-500 tracking-tighter">PAI <span class="text-white">B</span></span>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <button onclick="switchTab('home')" class="nav-btn text-white hover:text-red-400 px-3 py-2 rounded-md text-sm font-medium transition-colors">Home</button>
                            <button onclick="switchTab('structure')" class="nav-btn text-gray-300 hover:text-red-400 px-3 py-2 rounded-md text-sm font-medium transition-colors">Structure</button>
                            <button onclick="switchTab('documentation')" class="nav-btn text-gray-300 hover:text-red-400 px-3 py-2 rounded-md text-sm font-medium transition-colors">Documentation</button>
                            <button onclick="switchTab('finance')" class="nav-btn text-gray-300 hover:text-red-400 px-3 py-2 rounded-md text-sm font-medium transition-colors">Keuangan</button>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="toggleMusic()" id="music-btn" class="w-8 h-8 rounded-full bg-red-900/50 flex items-center justify-center text-red-400 border border-red-500/30 hover:bg-red-600 hover:text-white transition-all music-pulse">
                            <i class="fas fa-music"></i>
                        </button>
                        <div class="md:hidden">
                            <button id="mobile-menu-btn" onclick="toggleMobileMenu()" class="text-gray-300 hover:text-white p-2">
                                <i class="fas fa-bars text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="mobile-menu" class="md:hidden absolute top-16 left-0 w-full bg-black/95 backdrop-blur-md border-b border-red-900/30 overflow-hidden transition-all duration-300 ease-in-out max-h-0 opacity-0">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <button onclick="switchTab('home')" class="text-gray-300 hover:text-red-400 block px-3 py-2 rounded-md text-base font-medium w-full text-left">Home</button>
                    <button onclick="switchTab('structure')" class="text-gray-300 hover:text-red-400 block px-3 py-2 rounded-md text-base font-medium w-full text-left">Structure</button>
                    <button onclick="switchTab('documentation')" class="text-gray-300 hover:text-red-400 block px-3 py-2 rounded-md text-base font-medium w-full text-left">Documentation</button>
                    <button onclick="switchTab('finance')" class="text-gray-300 hover:text-red-400 block px-3 py-2 rounded-md text-base font-medium w-full text-left">Keuangan</button>
                </div>
            </div>
        </nav>

        <div class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none">
            <div class="absolute inset-0 bg-gradient-to-b from-black via-[#1a0000] to-black opacity-80"></div>
            <div class="hidden md:block absolute top-[-10%] left-[-10%] w-96 h-96 bg-red-900 rounded-full mix-blend-multiply filter blur-[100px] opacity-30 animate-pulse-slow"></div>
            <div class="hidden md:block absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-red-800 rounded-full mix-blend-multiply filter blur-[100px] opacity-30 animate-pulse-slow"></div>
        </div>

        <main class="flex-grow pt-20 px-4 md:px-8 max-w-7xl mx-auto w-full">

            <!-- HOME SECTION UPDATED (Jarak dirapatkan) -->
            <section id="home" class="active-section py-4 md:py-8 min-h-[calc(100vh-100px)] flex flex-col justify-center">
                <div class="grid md:grid-cols-2 gap-6 items-center">
                    <div class="space-y-4 text-center md:text-left order-2 md:order-1">
                        <h2 class="text-4xl md:text-6xl font-bold font-tech leading-tight uppercase">
                            WELCOME TO <br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-600">FACULTY TARBIYAH</span>
                        </h2>
                        <p class="text-gray-400 leading-relaxed text-sm md:text-base">
                            "Kami tidak hanya diajarkan cara mentransfer ilmu, tapi juga cara menanamkan adab. Karena ilmu tanpa adab seperti api tanpa kayu bakar, tak akan memberi kehangatan yang lama."
                        </p>
                        <div class="flex gap-4 pt-2 justify-center md:justify-start">
                            <button onclick="switchTab('documentation')" class="px-6 py-2.5 bg-red-700 hover:bg-red-600 rounded-lg text-white font-semibold transition-all shadow-[0_0_15px_rgba(220,38,38,0.5)]">Let's Go !!!</button>
                            <button onclick="switchTab('structure')" class="px-6 py-2.5 border border-gray-600 hover:border-red-500 hover:text-red-400 rounded-lg text-gray-300 font-semibold transition-all">Mahasiswa</button>
                        </div>
                        <div class="grid grid-cols-3 gap-4 pt-6 border-t border-gray-800 mt-4">
                            <div><h3 class="text-2xl font-bold text-white">24</h3><p class="text-xs text-gray-500 uppercase tracking-wider">Siswa</p></div>
                            <div><h3 class="text-2xl font-bold text-white">6</h3><p class="text-xs text-gray-500 uppercase tracking-wider">Laki-laki</p></div>
                            <div><h3 class="text-2xl font-bold text-white">18</h3><p class="text-xs text-gray-500 uppercase tracking-wider">Perempuan</p></div>
                        </div>
                    </div>
                    <div class="relative animate-float md:block order-1 md:order-2 flex flex-col items-center">
                        <div class="flex justify-center mb-6">
                            <img src="IAINU.jpg" alt="Class Logo" class="w-32 h-32 object-contain filter drop-shadow-[0_0_15px_rgba(220,38,38,0.5)] hover:scale-110 transition-transform duration-300 rounded-full bg-black/50" onerror="this.onerror=null; this.src='PAI B.jpg';">
                        </div>
                        <div class="glass-panel p-6 rounded-2xl transform rotate-3 hover:rotate-0 transition-all duration-500 border border-red-500/20 max-w-sm">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-red-500 to-black flex items-center justify-center"><i class="fas fa-quote-left text-white text-sm"></i></div>
                                <div><h4 class="font-bold text-base">Motto Kelas</h4><p class="text-[10px] text-red-400">Since 2025</p></div>
                            </div>
                            <blockquote class="text-sm font-light italic text-gray-300 mb-4">"Microteaching itu memang mendebarkan, tapi lebih mendebarkan lagi kalau melihat generasi muda rusak karena kurangnya pendidikan karakter."</blockquote>
                            <div class="flex justify-between items-center text-xs text-gray-500"><span>PAI B Family</span><i class="fas fa-fingerprint text-red-500 text-xl"></i></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- STRUCTURE SECTION UPDATED -->
            <section id="structure" class="hidden-section py-10 relative min-h-[600px]">
                <div class="mb-12">
                    <div class="text-center mb-6">
                        <h2 class="text-3xl md:text-5xl font-tech font-bold text-white mb-2 uppercase">STRUKTUR KELAS</h2>
                        <div class="h-1 w-20 bg-red-600 mx-auto rounded-full"></div>
                    </div>
                    <div class="max-w-4xl mx-auto px-4 flex justify-center">
                        <div class="relative w-full max-w-sm flex items-center justify-center bg-black/40 h-16 rounded-full border border-red-900/30 backdrop-blur-sm">
                            <button onclick="prevSemester()" id="btn-prev-sem" class="absolute left-4 z-20 text-2xl text-red-600 hover:text-white transform active:scale-90"><i class="fas fa-chevron-left"></i></button>
                            <div class="text-center w-full"><h3 id="current-semester-display" class="font-tech text-2xl md:text-3xl text-white font-bold tracking-widest transition-all">SEMESTER I</h3></div>
                            <button onclick="nextSemester()" id="btn-next-sem" class="absolute right-4 z-20 text-2xl text-red-600 hover:text-white transform active:scale-90"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
                
                <!-- CONTAINER UTAMA STRUKTUR -->
                <div id="structure-content-container"></div>
                
                <div class="text-center pb-12 mt-8 flex flex-col gap-4 items-center">
                     <button id="btn-team-executor" onclick="toggleTeamExecutor()" class="px-6 py-2 bg-gray-900 border border-gray-600 hover:border-red-500 rounded-full text-xs font-bold tracking-wider text-gray-300 hover:text-white transition-all shadow-md hidden"><i class="fas fa-network-wired mr-2"></i> TEAM EXECUTOR</button>
                    <button onclick="toggleFamilyGallery()" class="group relative px-10 py-4 bg-gradient-to-r from-red-900 to-black overflow-hidden rounded-xl border border-red-600/50 shadow-[0_0_30px_rgba(220,38,38,0.2)] hover:shadow-[0_0_50px_rgba(220,38,38,0.6)] transition-all duration-300">
                        <div class="flex items-center gap-3 relative z-10"><i class="fas fa-users text-2xl text-red-400 group-hover:text-white transition-colors"></i><span class="font-tech text-xl font-bold text-white tracking-widest uppercase">FAMILY PAI B</span></div>
                        <div class="absolute inset-0 bg-red-600 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </button>
                    <p class="text-gray-500 text-sm">Klik untuk melihat seluruh anggota keluarga kelas</p>
                </div>
            </section>

            <section id="documentation" class="hidden-section py-10">
                <div class="text-center mb-10">
                    <h2 class="text-3xl md:text-5xl font-tech font-bold text-white mb-2 uppercase">ARCHIVES</h2>
                    <div class="h-1 w-20 bg-red-600 mx-auto rounded-full mb-4"></div>
                    <p class="text-gray-400 mb-6">Class Memories & Moments</p>
                    <div class="flex flex-col md:flex-row justify-center items-center gap-3 max-w-xl mx-auto">
                        <div class="relative w-full">
                            <input type="text" id="doc-search" placeholder="Search by title..." onkeyup="handleSearch(event)" class="w-full bg-black/40 border border-red-500/30 rounded-lg px-4 py-2 text-white text-sm focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 placeholder-gray-500 transition-all text-center md:text-left">
                            <button onclick="handleSearch({key: 'Enter'})" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"><i class="fas fa-search"></i></button>
                        </div>
                        <button onclick="openAllFiles()" class="w-full md:w-auto bg-red-900/30 hover:bg-red-800 border border-red-500/50 text-white px-6 py-2 rounded-lg text-sm transition-all whitespace-nowrap flex items-center justify-center gap-2"><i class="fas fa-th-large"></i> All Files</button>
                    </div>
                </div>
                <div id="documentation-grid" class="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6"></div>
            </section>

            <section id="finance" class="hidden-section py-10 min-h-[600px] flex justify-center items-center">
                <div id="finance-login" class="max-w-md w-full px-4">
                    <div class="glass-panel p-8 rounded-2xl border border-red-500/30">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-red-900/50 rounded-full flex items-center justify-center mx-auto mb-4 border border-red-500">
                                <i class="fas fa-lock text-red-400 text-2xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-white font-tech tracking-wider">SECURE ACCESS</h2>
                            <p class="text-gray-400 text-sm mt-2">Masuk untuk melihat data keuangan</p>
                        </div>

                        <form onsubmit="handleFinanceLogin(event)" class="space-y-6">
                            <div>
                                <label class="block text-gray-400 text-xs uppercase tracking-wider mb-2">Username</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-user text-gray-500"></i>
                                    </div>
                                    <input type="text" id="finance-user" class="w-full bg-black/50 border border-gray-700 rounded-lg py-3 pl-10 pr-4 text-white placeholder-gray-600 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-all" placeholder="Enter username">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 text-xs uppercase tracking-wider mb-2">Password</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-key text-gray-500"></i>
                                    </div>
                                    <input type="password" id="finance-pass" class="w-full bg-black/50 border border-gray-700 rounded-lg py-3 pl-10 pr-4 text-white placeholder-gray-600 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-all" placeholder="••••••••">
                                </div>
                                <p id="pass-error-msg" class="text-red-500 text-xs mt-2 hidden flex items-center">
                                    <i class="fas fa-exclamation-circle mr-1"></i> Data tidak Valid
                                </p>
                            </div>

                            <button type="submit" class="w-full bg-red-700 hover:bg-red-600 text-white font-bold py-3 rounded-lg transition-all shadow-[0_0_15px_rgba(220,38,38,0.4)]">
                                LOGIN
                            </button>
                        </form>
                    </div>
                </div>

                <div id="finance-dashboard" class="hidden w-full max-w-4xl px-4 flex flex-col items-center">
                    <div class="text-center mb-10 w-full">
                        <h2 class="text-3xl md:text-5xl font-tech font-bold text-white mb-2">KEUANGAN KELAS</h2>
                        <div class="h-1 w-20 bg-red-600 mx-auto rounded-full"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 w-full">
                        <div class="glass-panel p-8 rounded-2xl border border-red-500/30 relative overflow-hidden group">
                            <div class="absolute -right-6 -top-6 w-32 h-32 bg-red-600 rounded-full opacity-10 blur-xl group-hover:opacity-20 transition-all"></div>
                            <div class="relative z-10">
                                <p class="text-gray-400 text-sm uppercase tracking-widest mb-2">Total Saldo Kas</p>
                                <h3 id="total-saldo-display" class="text-4xl md:text-5xl font-bold text-white mb-4 font-saldo-custom">Rp ...</h3>
                                <div class="flex items-center text-green-400 text-sm">
                                    <i class="fas fa-sync-alt mr-1 animate-spin-slow" id="saldo-loading-icon"></i>
                                    <span id="saldo-status-text">Sinkronisasi Data...</span>
                                </div>
                            </div>
                        </div>

                        <div class="glass-panel p-8 rounded-2xl border border-gray-700/50 relative overflow-hidden">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 flex items-center justify-center text-blue-400">
                                    <i class="fas fa-info-circle text-2xl"></i>
                                </div>
                                <div class="pt-2">
                                    <h4 class="text-white font-bold text-lg mb-2">Penting</h4>
                                    <p class="text-gray-400 text-sm leading-relaxed">
                                        Pembayaran kas bulan ini harap segera dilunasi sebelum berganti bulan berikutnya. Supaya tidak menumpuk dikemudian hari terimakasih atas pengertiannya.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="logoutFinance()" class="mx-auto block text-red-400 hover:text-white text-sm transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i> Keluar dari sesi keuangan
                    </button>
                </div>
            </section>
        </main>
        
        <footer class="border-t border-red-900/30 bg-black/90 mt-12 pt-12 pb-8">
            <div class="max-w-7xl mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-8 border-b border-red-900/30 pb-8">
                    <div class="text-left">
                         <h3 class="font-tech text-xl text-white font-bold mb-4 border-b-2 border-red-600 inline-block pb-1">FAKULTAS TARBIYAH</h3>
                         <p class="text-gray-400 text-sm leading-relaxed mt-2">Mencetak pendidik yang berakhlak mulia, berwawasan luas, dan kompeten dalam menjawab tantangan zaman.</p>
                    </div>
                    <div class="text-left">
                        <h3 class="font-tech text-xl text-white font-bold mb-4 border-b-2 border-red-600 inline-block pb-1">KONTAK KAMI</h3>
                        <div class="mt-2 flex flex-col gap-2">
                            <a href="https://maps.app.goo.gl/tfdwTJTneTn89ey36" target="_blank" class="text-gray-400 text-sm flex items-center hover:text-white transition-colors group"><i class="fas fa-map-marker-alt text-red-500 w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> Jl. Tentara Pelajar No. 55B</a>
                            <!-- UPDATE WA LINK FOOTER -->
                            <a href="https://wa.me/6285179920064" target="_blank" class="text-gray-400 text-sm flex items-center hover:text-white transition-colors group"><i class="fas fa-phone text-red-500 w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> 0851-7992-0064</a>
                            <a href="https://twitter.com/iainu_kebumen" target="_blank" class="text-gray-400 text-sm flex items-center hover:text-white transition-colors group"><i class="fab fa-twitter text-red-500 w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> @iainu_kebumen</a>
                        </div>
                    </div>
                    <div class="text-left">
                        <h3 class="font-tech text-xl text-white font-bold mb-4 border-b-2 border-red-600 inline-block pb-1">AKADEMIK</h3>
                        <div class="mt-2">
                            <p class="text-gray-400 text-sm mb-2"><i class="fas fa-graduation-cap text-red-500 mr-2"></i> Pendidikan Agama Islam</p>
                            <p class="text-gray-400 text-sm mb-2"><i class="fas fa-calendar-alt text-red-500 mr-2"></i> Angkatan 2025</p>
                            <p class="text-gray-400 text-sm"><i class="fas fa-users text-red-500 mr-2"></i> Kelas B</p>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="font-tech text-gray-500 text-sm text-center md:text-left">© 2025 PAI B - IAINU KEBUMEN. All Rights Reserved.</p>
                    <div class="flex gap-4">
                        <a href="https://www.instagram.com/iainukebumen/" target="_blank" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:bg-red-600 hover:text-white transition-all duration-300"><i class="fab fa-instagram"></i></a>
                        <a href="https://iainu-kebumen.ac.id/" target="_blank" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:bg-blue-500 hover:text-white transition-all duration-300"><i class="fas fa-globe"></i></a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- MODAL AUTH ERROR (KEUANGAN) -->
    <div id="auth-error-modal" class="custom-modal" style="z-index: 9999;">
        <div class="bg-black/90 border border-red-600 rounded-xl p-8 max-w-sm w-full mx-4 text-center transform scale-100 shadow-[0_0_50px_rgba(220,38,38,0.5)]">
            <h3 class="text-2xl font-bold text-white mb-2 font-tech">AUTHORIZATION FAILED</h3>
            <p class="text-gray-400 text-sm mb-6">Silahkan masukan data yang valid untuk melanjutkan.</p>
            <button onclick="closeAuthError()" class="bg-red-700 hover:bg-red-600 text-white px-6 py-2 rounded-lg text-sm font-bold transition-colors w-full">COBA LAGI</button>
        </div>
    </div>

    <!-- MODAL TEAM EXECUTOR -->
    <div id="team-executor-modal" class="fullscreen-overlay" tabindex="0">
        <div class="w-full min-h-screen pt-10 pb-10 relative flex flex-col">
             <button onclick="toggleTeamExecutor()" class="fixed top-4 right-4 md:top-8 md:right-8 z-50 bg-black/50 hover:bg-red-600 text-white w-12 h-12 rounded-full backdrop-blur-sm border border-red-500/30 transition flex items-center justify-center text-xl shadow-lg group">
                <i class="fas fa-times group-hover:rotate-90 transition-transform duration-300"></i>
            </button>
            
            <div class="text-center mb-10 px-4 sticky top-0 bg-gradient-to-b from-[#050000] via-[#050000] to-transparent z-40 pb-4 pt-4">
                <h2 class="text-3xl md:text-5xl font-tech font-bold text-white mb-2 text-shadow-glow uppercase">TEAM EXECUTOR</h2>
            </div>

            <div id="executor-tree-container" class="tree flex-grow flex items-start justify-center overflow-auto px-4"></div>
        </div>
    </div>

    <!-- MODAL PASSWORD (STRUKTUR) -->
    <div id="password-modal" class="custom-modal">
        <div class="bg-[#0f0505] border border-red-800 rounded-xl p-6 max-w-xs w-full mx-4 shadow-2xl text-center relative z-50">
            <div class="mb-4">
                <i class="fas fa-lock text-4xl text-red-600 mb-2"></i>
                <h3 class="text-lg font-bold text-white font-tech uppercase">KEAMANAN</h3>
                <p class="text-gray-400 text-xs mt-1">Masukkan Password Admin</p>
            </div>
            <input type="password" id="admin-password" class="w-full bg-black border border-gray-700 rounded-lg py-2 px-3 text-white text-center focus:border-red-500 mb-2 tracking-widest outline-none" placeholder="••••••••">
            <p id="password-error" class="text-red-500 text-[10px] mb-3 hidden">Password Salah!</p>
            
            <div class="flex gap-2">
                <button onclick="closePasswordModal()" class="flex-1 py-2 rounded-lg border border-gray-700 text-gray-400 text-sm hover:bg-gray-900 transition-colors">Batal</button>
                <button onclick="confirmAction()" class="flex-1 py-2 rounded-lg bg-red-700 text-white font-bold hover:bg-red-600 text-sm uppercase transition-colors">Ok</button>
            </div>
        </div>
    </div>

    <!-- MODAL EDIT / PREVIEW -->
    <div id="edit-modal" class="edit-modal">
        <div class="bg-[#0f0505] border border-red-800 rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl relative overflow-hidden">
             <!-- Background Glow -->
            <div class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl from-red-900 to-transparent opacity-20"></div>
            
            <button onclick="closeEditModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white z-20"><i class="fas fa-times text-xl"></i></button>

            <!-- FORM ISI DATA -->
            <div id="edit-form-container">
                <h3 class="text-xl font-bold text-white mb-6 font-tech uppercase flex items-center gap-2"><i class="fas fa-pen-to-square text-red-500"></i> ISI DATA</h3>
                <div class="mb-6">
                    <label class="block text-red-400/70 text-xs font-bold uppercase mb-2">Nama Lengkap</label>
                    <input type="text" id="input-name" class="w-full bg-black border border-gray-800 rounded-lg py-3 px-4 text-white placeholder-gray-600 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-all font-body tracking-wide" placeholder="Ketik nama disini..." autocomplete="off">
                </div>
                <div class="flex gap-3">
                    <button onclick="closeEditModal()" class="flex-1 py-2.5 rounded-lg border border-gray-700 text-gray-400 hover:bg-gray-900 hover:text-white transition-colors text-sm font-semibold">Batal</button>
                    <button onclick="initiateAction('save')" class="flex-1 py-2.5 rounded-lg bg-gradient-to-r from-red-800 to-red-600 text-white font-bold hover:from-red-700 hover:to-red-500 transition-all shadow-lg text-sm tracking-wide flex justify-center items-center gap-2"><span>Simpan</span></button>
                </div>
            </div>

            <!-- PREVIEW & DELETE -->
            <div id="preview-container" class="hidden flex-col items-center text-center">
                <h3 class="text-xl font-bold text-white mb-4 font-tech uppercase tracking-widest">DATA ANGGOTA</h3>
                <div class="w-full aspect-square bg-gray-900 rounded-xl overflow-hidden mb-4 border-2 border-red-900/50 relative group">
                     <img id="preview-img" src="" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" referrerpolicy="no-referrer">
                </div>
                <h4 id="preview-name" class="text-white font-bold text-xl mb-6 font-body">Nama</h4>
                <button onclick="initiateAction('delete')" class="w-full py-3 rounded-lg bg-red-950/40 border border-red-600 text-red-500 hover:bg-red-600 hover:text-white transition-all font-bold uppercase tracking-wider flex items-center justify-center gap-2 group">
                    <i class="fas fa-trash-alt group-hover:animate-bounce"></i> HAPUS DATA
                </button>
            </div>
        </div>
    </div>

    <!-- FAMILY GALLERY -->
    <div id="family-gallery" class="fullscreen-overlay" tabindex="0">
        <div class="max-w-7xl mx-auto px-4 pt-24 pb-10 relative">
            <button onclick="toggleFamilyGallery()" class="fixed top-6 right-6 z-50 bg-red-600 text-white w-12 h-12 rounded-full hover:bg-red-500 transition flex items-center justify-center text-xl shadow-lg border-2 border-black"><i class="fas fa-times"></i></button>
            <div class="text-center mb-12"><h2 class="text-4xl md:text-6xl font-tech font-bold text-white mb-2 uppercase">KELUARGA PAI B</h2><p class="text-red-400 text-lg">Selalu di Hati</p></div>
            <div id="student-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6"></div>
        </div>
    </div>
    
    <div id="all-files-overlay" class="fullscreen-overlay" tabindex="0">
        <div class="max-w-7xl mx-auto px-4 pt-24 pb-10 relative">
            <button onclick="closeAllFiles()" class="fixed top-6 right-6 z-50 bg-red-600 text-white w-12 h-12 rounded-full hover:bg-red-500 transition flex items-center justify-center text-xl shadow-lg border-2 border-black"><i class="fas fa-times"></i></button>
            <div class="text-center mb-12"><h2 class="text-4xl md:text-5xl font-tech font-bold text-white mb-2">ALL UPLOADED FILES</h2><p class="text-gray-400 text-sm">Memories Activities PAI B 2025</p></div>
            <div id="all-files-grid" class="columns-2 md:columns-3 lg:columns-4 gap-4 space-y-4"></div>
        </div>
    </div>
    
    <div id="bio-modal" class="custom-modal" onclick="closeBioModal(event)">
        <div id="bio-content" class="glass-panel w-[90%] md:w-full max-w-6xl max-h-[90vh] md:max-h-[85vh] overflow-y-auto transform scale-95 transition-all duration-300 rounded-2xl flex flex-col md:flex-row bg-black/90 border border-red-500/30 shadow-2xl relative overflow-hidden" tabindex="0">
            <div class="w-full md:w-5/12 aspect-[9/16] relative bg-gray-900 group shrink-0">
                <div id="modal-img-loader" class="img-loading-skeleton"><i class="fas fa-spinner fa-spin text-red-900 text-4xl"></i></div>
                <img id="modal-img" src="" alt="Profile Photo" class="relative z-10 w-full h-full object-cover transition-opacity duration-500 opacity-0" onerror="this.src='https://placehold.co/400x500?text=No+Image';">
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent md:bg-gradient-to-r md:from-transparent md:to-black/90 z-20 pointer-events-none"></div>
                <button onclick="closeBioModal(null, true)" class="md:hidden absolute top-4 right-4 z-50 bg-black/50 text-white w-8 h-8 rounded-full flex items-center justify-center backdrop-blur-sm border border-white/20"><i class="fas fa-times"></i></button>
            </div>
            <div class="w-full md:w-7/12 p-6 md:p-10 flex flex-col justify-center text-left relative bg-black/50 md:bg-transparent">
                <div class="absolute top-0 right-0 p-6 opacity-10 hidden md:block"><i class="fas fa-fingerprint text-9xl text-red-600"></i></div>
                <div class="mb-6 md:mb-10 relative z-10">
                    <h2 id="modal-name" class="text-2xl md:text-6xl font-bold text-white font-tech mb-2 tracking-wide leading-tight drop-shadow-lg">Name Here</h2>
                    <div class="flex items-center gap-3"><span class="px-4 py-1 bg-red-900/40 border border-red-500/30 rounded text-red-400 font-mono text-xs md:text-base tracking-wider" id="modal-nim">NIM: 00000000</span></div>
                </div>
                <div class="space-y-6 relative z-10">
                    <div class="bio-info-row group flex items-start gap-4"><div class="bio-icon-box w-10 h-10 md:w-14 md:h-14 rounded-full bg-red-900/20 flex items-center justify-center text-red-500 border border-red-500/10"><i class="fab fa-instagram text-xl"></i></div><div class="flex-grow pt-1 md:pt-2"><span class="text-[10px] md:text-xs text-gray-500 uppercase tracking-[0.2em] font-bold block mb-1">Instagram</span><div id="modal-ig" class="text-sm md:text-xl"></div></div></div>
                    <div class="bio-info-row group flex items-start gap-4"><div class="bio-icon-box w-10 h-10 md:w-14 md:h-14 rounded-full bg-red-900/20 flex items-center justify-center text-red-500 border border-red-500/10"><i class="fas fa-quote-left text-xl"></i></div><div class="flex-grow pt-1 md:pt-2"><span class="text-[10px] md:text-xs text-gray-500 uppercase tracking-[0.2em] font-bold block mb-1">About Me</span><p id="modal-bio" class="text-gray-300 font-light leading-relaxed text-sm md:text-xl italic pr-2 md:pr-8 text-justify">"..."</p></div></div>
                </div>
                 <button onclick="closeBioModal(null, true)" class="hidden md:flex absolute top-6 right-6 z-50 bg-transparent text-white/50 hover:text-white transition w-10 h-10 items-center justify-center text-2xl"><i class="fas fa-times"></i></button>
            </div>
        </div>
    </div>
    <div id="media-modal" class="custom-modal" onclick="closeMediaModal(event)">
        <div class="relative max-w-5xl w-full mx-4 flex justify-center"><div id="media-container" class="max-h-[85vh] rounded-lg shadow-2xl border border-red-500/30"></div></div>
    </div>

    <script>
        const textToType = "PAI B";
        const typingElement = document.getElementById('typing-text');
        let i = 0;
        function typeWriter() { if (i < textToType.length) { typingElement.innerHTML += textToType.charAt(i); i++; setTimeout(typeWriter, 150); } }

        const GOOGLE_SCRIPT_URL = 'PASTE_YOUR_GOOGLE_SCRIPT_DEPLOYMENT_URL_HERE';
        const STRUCTURE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzfGOk2K0P5fUo1CBL5-Z9vmdJv38SmKBxvruznU986j-L9Oqspea1jtE_L9KKbT0iqVQ/exec";

        const dbFoto = {
            "Ady Surya": "https://lh3.googleusercontent.com/d/1z5JRHNaprGcbhl1d5dxNKW1Y4CGVGa-A",
            "Ahmad Lubadul Fikri": "https://lh3.googleusercontent.com/d/1wivrdbIcim8CyUio4srAiZ4tPyXu6taH",
            "Alyvia Qurrotal A.": "https://lh3.googleusercontent.com/d/11EucklVY9pmkB6-IomvtRZAyFFzVTRoW",
            "Anggun Lolyka H.": "https://lh3.googleusercontent.com/d/1D2ATUmALVTpPS5CoyqlKWTsZJh8LNF2d",
            "Aqillah Mazaya": "https://lh3.googleusercontent.com/d/1Av6SMF4g5x4RVe9olnxoowj6ccqeSn50",
            "Arina Manasika": "https://lh3.googleusercontent.com/d/1j-tiqZpNxPCvCK53YDL61fXgZbydjgd1",
            "Devi Kurniasari": "https://lh3.googleusercontent.com/d/1a0bIQm8m9mIm5a3-zjQRyiW-hMF5_7D9",
            "Elok Iis N.": "https://lh3.googleusercontent.com/d/1KIdkI-mlAZxOz0zHh6gdT8jZx_4mJe4L",
            "Farihatul Azizah": "https://lh3.googleusercontent.com/d/15BUdEmviUdjpoh4UI8dZZx41AsXEfqUX",
            "Hanan Tsuroya A.": "https://lh3.googleusercontent.com/d/1B8-4FSJGQauz6yrncfpkZRHaRLG3xTvF",
            "Hanni Hasanati": "https://lh3.googleusercontent.com/d/1jn_xKJcu7nZ0Nl5fVhvg_NWlBmYnswUP",
            "Jembar Juli Y.": "https://lh3.googleusercontent.com/d/1vQoS8GhZ3HlbwD9tqIy6a6iXBWxo4w8k",
            "Lusi Rahmah O.": "https://lh3.googleusercontent.com/d/1FaB6bGBgsxIBVtFRrd7r24fIQpUM8qlH",
            "M. Hanif Fakhry": "https://lh3.googleusercontent.com/d/1KytnHSsBLr26o56VOcyoHnjKcOP6vJPX",
            "Pniel Munandar": "https://lh3.googleusercontent.com/d/1pWXnDqhmfewv37D679deqQQmf57RgivY",
            "Putri Dwi Astuti": "https://lh3.googleusercontent.com/d/1h0LyPmhjMDBTDvL1zNInPnD0QDEKgTNP",
            "Riska Ayu K.": "https://lh3.googleusercontent.com/d/1TsYTbbe-lnhKTV-xArDwTEXiEmongaxC",
            "Siti Ulfatur R.": "https://lh3.googleusercontent.com/d/1uT6FlbDlD0QBlmLRkwp8oY2xHrhhaZuq",
            "Tsabita Hasna H.": "https://lh3.googleusercontent.com/d/1cRGStdgeYdjFJYpHS4YZ8WsIGKSXQzx8",
            "Ubaidillah M.": "https://lh3.googleusercontent.com/d/1dKM1F66xTidpXFtt1WZAX45hSKMcocT3",
            "Yoana Dian R.A.": "https://lh3.googleusercontent.com/d/1Pri-9DSWYsbho_WVBX444W3ZmOsnDGsi",
            "Youvischa Aulia A.": "https://lh3.googleusercontent.com/d/1ahpDR_ZrU3ISQv7FSx7WwIFW6Gny9FC2",
            "Yuyun Lutfiyatul K.": "https://lh3.googleusercontent.com/d/1YfPxVrroo9VHQX-RF72I3hWdF5YaR5UQ",
            "Zain Nur Fadilah": "https://lh3.googleusercontent.com/d/16Snhd6QcxqMKtQD3vYHNzw7H8_xr4QUR"
        };

        const studentsData = [
            { name: "Ady Surya", nim: "2511038", ig: "@suryaadharm_", img: dbFoto["Ady Surya"], bioImg: dbFoto["Ady Surya"], bio: "Saya orang yang menyukai berpetualang dan menikmati keindahan alam untuk menghilangkan kebosanan dan mengagumi ciptaan Tuhan, sungguh indah." },
            { name: "A. Lubadul Fikri", nim: "2511046", ig: "@bangkriii_", img: dbFoto["Ahmad Lubadul Fikri"], bioImg: dbFoto["Ahmad Lubadul Fikri"], bio: "Seseorang yang berkepribadian introvert abizzz. Saya ingin melihat dan memahami dunia di luar sana." },
            { name: "Alyvia Qurrotal A.", nim: "2511042 ", ig: "@piaa.ainiii", img: dbFoto["Alyvia Qurrotal A."], bioImg: dbFoto["Alyvia Qurrotal A."], bio: "Saya dikenal sebagai pribadi yang ceria, aktif, dan antusias. Saya juga menyukai tentang hal-hal baru yang membuat saya berkembang." },
            { name: "Anggun Lolyka H.", nim: "2511043", ig: "@_nnggunn_", img: dbFoto["Anggun Lolyka H."], bioImg: dbFoto["Anggun Lolyka H."], bio: "Saya orang yang kreatif dengan rasa ingin tahu yang tinggi. Saya senang mempelajari hal-hal baru." },
            { name: "Aqillah Mazaya", nim: "2511043", ig: "@aqilahmz._", img: dbFoto["Aqillah Mazaya"], bioImg: dbFoto["Aqillah Mazaya"], bio: "Saya memiliki minat di bidang agama dan pendidikan. Saya berharap dapat menjadi pendidik yang amanah." },
            { name: "Arina Manasika", nim: "2511065", ig: "@mnskaaa_", img: dbFoto["Arina Manasika"], bioImg: dbFoto["Arina Manasika"], bio: "Saya berusaha menjadi pribadi yang terus bertumbuh dan berani keluar dari zona nyaman." },
            { name: "Devi Kurniasari", nim: "2511052", ig: "@devy____08", img: dbFoto["Devi Kurniasari"], bioImg: dbFoto["Devi Kurniasari"], bio: "Saya pantang menyerah untuk meraih masa depan. Ke-depannya, saya ingin menjadi pribadi yang lebih baik." },
            { name: "Elok Iis N.", nim: "2511060", ig: "@dhe.el", img: dbFoto["Elok Iis N."], bioImg: dbFoto["Elok Iis N."], bio: "Senyum adalah sedekah termudah. Selalu berusaha menyebarkan positif vibes." },
            { name: "Farihatul Azizah", nim: "2511037", ig: "@fariha_aziizah", img: dbFoto["Farihatul Azizah"], bioImg: dbFoto["Farihatul Azizah"], bio: "Introvert, Bermimpilah dan raihlah mimpi itu dengan ilmu yang bermanfaat." },
            { name: "Hanan Tsuroya A.", nim: "2511073", ig: "@hanan_akyasi", img: dbFoto["Hanan Tsuroya A."], bioImg: dbFoto["Hanan Tsuroya A."], bio: "Saya sangat menyukai alam. Rumah saya di Kebumen dan saya sangat suka kuliah di IAINU Kebumen." },
            { name: "Hanni Hasanati", nim: "2511068", ig: "@hannihsnt_", img: dbFoto["Hanni Hasanati"], bioImg: dbFoto["Hanni Hasanati"], bio: "Saya anak kedua dari tiga bersaudara. Saat ini saya kuliah di IAINU Kebumen, jurusan Pendidikan Agama Islam." },
            { name: "Jembar Juli Y.", nim: "2511049", ig: "@jembarjulyy_", img: dbFoto["Jembar Juli Y."], bioImg: dbFoto["Jembar Juli Y."], bio: "Saya orang yang ceria dan periang. Saya suka tersenyum dan membuat orang lain merasa nyaman di sekitar saya." },
            { name: "Lusi Rahmah O.", nim: "2511080", ig: "@lusioktaviara", img: dbFoto["Lusi Rahmah O."], bioImg: dbFoto["Lusi Rahmah O."], bio: "Saya punya banyak impian untuk masa depan, terutama menjadi orang sukses, kaya, dan dermawan." },
            { name: "M. Hanif Fakhry", nim: "2511079", ig: "@hann_id1028", img: dbFoto["M. Hanif Fakhry"], bioImg: dbFoto["M. Hanif Fakhry"], bio: "Alhamdulillah saya mampu menguasai perangkat lunak desain seperti Canva, Solidwork, Panzoid, dll." },
            { name: "Pniel Munandar", nim: "2511053", ig: "@pniel76", img: dbFoto["Pniel Munandar"], bioImg: dbFoto["Pniel Munandar"], bio: "Saya sangat suka bermain musik, terutama drum. Saya juga bekerja sebagai karyawan untuk mendapatkan penghasilan sendiri." },
            { name: "Putri Dwi Astuti", nim: "2511061", ig: "@putridwia12_", img: dbFoto["Putri Dwi Astuti"], bioImg: dbFoto["Putri Dwi Astuti"], bio: "saya suka suasana yang damai dan sejuk karena membuat saya senang prinsip hidup saya adalah selalu berbuat yang terbaik." },
            { name: "Riska Ayu K.", nim: "2511039", ig: "@baiza_salma", img: dbFoto["Riska Ayu K."], bioImg: dbFoto["Riska Ayu K."], bio: "Saya seorang pemikir, pemilih, dan individu yang sangat ambisius di dunia akademis." },
            { name: "Siti Ulfatur R.", nim: "2511077", ig: "@sssittt_____", img: dbFoto["Siti Ulfatur R."], bioImg: dbFoto["Siti Ulfatur R."], bio: "Saya anak pertama dari 3 bersaudara. Menjadi anak pertama memang tidak mudah, apalagi perempuan." },
            { name: "Tsabita Hasna H.", nim: "2511071", ig: "@tsabitahasna.__", img: dbFoto["Tsabita Hasna H."], bioImg: dbFoto["Tsabita Hasna H."], bio: "Saya adalah seseorang yang terus belajar dari setiap langkah. Luka menguatkan saya, doa menenangkan saya." },
            { name: "Ubaidillah M.", nim: "2511064", ig: "@muss_tffa", img: dbFoto["Ubaidillah M."], bioImg: dbFoto["Ubaidillah M."], bio: "Saya ubaid, pribadi yang percaya bahwa selama aku bernapas, selalu ada harapan untuk terus maju." },
            { name: "Yoana Dian R.A.", nim: "2511054", ig: "@yoana.diaan", img: dbFoto["Yoana Dian R.A."], bioImg: dbFoto["Yoana Dian R.A."], bio: "Prinsip hidup saya adalah tetap bersyukur, jangan membandingkan diri dengan orang lain." },
            { name: "Youvischa Aulia A.", nim: "2511057", ig: "@youvischa_sinta", img: dbFoto["Youvischa Aulia A."], bioImg: dbFoto["Youvischa Aulia A."], bio: "Halo, nama saya Vischa. Saya anak tertua dari dua bersaudara. Saat ini saya kuliah di IAINU Kebumen." },
            { name: "Yuyun Lutfiyatul K.", nim: "2511051", ig: "@yuyunltfykh_", img: dbFoto["Yuyun Lutfiyatul K."], bioImg: dbFoto["Yuyun Lutfiyatul K."], bio: "Saya menyukai aktivitas memasak dan berkebun. Pengalaman paling menyenangkan saya adalah saat mendaki gunung." },
            { name: "Zain Nur Fadilah", nim: "2511076", ig: "@Artyzeen08", img: dbFoto["Zain Nur Fadilah"], bioImg: dbFoto["Zain Nur Fadilah"], bio: "Takdir menempatkan saya sebagai yang tertua di PAI B 2025, tapi itu hanyalah angka di atas kertas." }
        ];

        const existingMedia = [
            { type: 'video', src: 'JJ 1.mp4', title: 'JJ', ratio: 'aspect-[9/16]' },
            { type: 'image', src: 'PAI B.jpg', title: 'Logo', ratio: 'aspect-square' },
            { type: 'video', src: 'English Tim.mp4', title: 'English Game', ratio: 'aspect-video' },
            { type: 'image', src: 'Fotbar Sekelas 2.jpg', title: 'Fotbar', ratio: 'aspect-[4/5]' },
            { type: 'video', src: 'WhatsApp Video 2025-11-30 at 10.44.47.mp4', title: 'Clip', ratio: 'aspect-[4/5]' },
            { type: 'image', src: 'Series PAI B.jpg', title: 'PAI B SERIES', ratio: 'aspect-video' },
            { type: 'video', src: 'Penutupan 2025.mp4', title: 'Memories', ratio: 'aspect-square' },
            { type: 'image', src: 'Fotbar Sekelas.jpg', title: 'Fotbar', ratio: 'aspect-[9/16]' }
        ];

        const allFilesData = [
            ...existingMedia,
            { type: 'image', src: 'https://placehold.co/600x800/1a0505/FFF?text=FOTO+9', title: '-', ratio: 'aspect-[3/4]' },
            { type: 'video', src: 'JJ 1.mp4', title: 'Video 10', ratio: 'aspect-[9/16]' }
        ];

        const semesterList = ["I", "II", "III", "IV", "V", "VI", "VII", "VIII"];
        let currentSemesterIndex = 0;
        let currentEditTarget = null;
        let pendingAction = null; 
        let semesterData = {}; 
        let SERVER_PASSWORD = ""; 

        window.onload = function() {
            typeWriter();
            generateStudents(); 
            initDocumentation(); 
            updateSemesterDisplay(); 
            loadStructureData();
            if (!history.state) { history.replaceState({ page: 'home' }, '', '#home'); }
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12') { e.preventDefault(); return false; }
                if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) { e.preventDefault(); return false; }
                if (e.ctrlKey && e.key === 'u') { e.preventDefault(); return false; }
                if (e.ctrlKey && e.key === 's') { e.preventDefault(); return false; }
            });

            document.getElementById('input-name').addEventListener('keypress', (e) => { if (e.key === 'Enter') initiateAction('save'); });
            document.getElementById('admin-password').addEventListener('keypress', (e) => { if (e.key === 'Enter') confirmAction(); });
        };

        function enterSite() { const intro = document.getElementById('intro-screen'); const mainApp = document.getElementById('main-app'); const audio = document.getElementById('bg-music'); if (audio) { audio.play().catch(error => { console.log("Audio autoplay blocked:", error); }); } intro.style.transform = 'translateY(-100%)'; intro.style.opacity = '0'; mainApp.classList.remove('hidden'); setTimeout(() => { mainApp.style.opacity = '1'; setTimeout(() => { intro.style.display = 'none'; }, 800); }, 100); }

        let isPlaying = true;
        function toggleMusic() { const audio = document.getElementById('bg-music'); const btn = document.getElementById('music-btn'); if (isPlaying) { audio.pause(); btn.innerHTML = '<i class="fas fa-volume-mute"></i>'; btn.classList.remove('music-pulse'); isPlaying = false; } else { audio.play(); btn.innerHTML = '<i class="fas fa-music"></i>'; btn.classList.add('music-pulse'); isPlaying = true; } }
        document.addEventListener('visibilitychange', function() { const audio = document.getElementById('bg-music'); if (document.hidden) { audio.pause(); } else { if(isPlaying) { audio.play().catch(e => console.log("Resume prevented", e)); } } });

        function switchTab(tabId) {
            if (tabId !== 'finance') { logoutFinance(); }
            const loader = document.getElementById('page-loader'); loader.classList.remove('opacity-0', 'pointer-events-none'); loader.classList.add('active'); 
            setTimeout(() => {
                const currentState = history.state ? history.state.page : 'home'; const isGoingHome = tabId === 'home'; const isCurrentlyHome = currentState === 'home';
                _switchTabUI(tabId); window.scrollTo(0, 0);
                if (isGoingHome) { if (!isCurrentlyHome) { history.replaceState({ page: 'home' }, '', '#home'); } } else { if (isCurrentlyHome) { history.pushState({ page: tabId }, '', '#' + tabId); } else { history.replaceState({ page: tabId }, '', '#' + tabId); } }
                setTimeout(() => { loader.classList.remove('active'); loader.classList.add('opacity-0', 'pointer-events-none'); }, 300);
            }, 500); 
        }
        function _switchTabUI(tabId) { const sections = document.querySelectorAll('main section'); const target = document.getElementById(tabId); if (target && target.classList.contains('active-section')) { return; } sections.forEach(section => { section.classList.remove('active-section'); section.classList.add('hidden-section'); section.style.display = 'none'; }); if (target) { if (tabId === 'finance') { target.style.display = 'flex'; } else { target.style.display = 'block'; } requestAnimationFrame(() => { target.classList.remove('hidden-section'); target.classList.add('active-section'); }); } const menu = document.getElementById('mobile-menu'); if (menu.classList.contains('max-h-screen')) { toggleMobileMenu(); } }
        function toggleMobileMenu() { const menu = document.getElementById('mobile-menu'); if (menu.classList.contains('max-h-0')) { menu.classList.remove('max-h-0', 'opacity-0'); menu.classList.add('max-h-screen', 'opacity-100'); } else { menu.classList.remove('max-h-screen', 'opacity-100'); menu.classList.add('max-h-0', 'opacity-0'); } }

        function handleFinanceLogin(e) { e.preventDefault(); const user = document.getElementById('finance-user').value; const pass = document.getElementById('finance-pass'); if (user === 'Tarbiyah' && pass.value === 'paib.2025') { document.getElementById('finance-login').classList.add('hidden'); document.getElementById('finance-dashboard').classList.remove('hidden'); document.getElementById('pass-error-msg').classList.add('hidden'); fetchFinanceData(); } else { pass.value = ''; document.getElementById('pass-error-msg').classList.remove('hidden'); document.getElementById('auth-error-modal').classList.add('active'); } }
        async function fetchFinanceData() { if(GOOGLE_SCRIPT_URL === '' || GOOGLE_SCRIPT_URL.includes('PASTE_YOUR')) return; const saldoDisplay = document.getElementById('total-saldo-display'); const statusText = document.getElementById('saldo-status-text'); const icon = document.getElementById('saldo-loading-icon'); try { icon.classList.remove('hidden'); statusText.innerText = "Sinkronisasi..."; const response = await fetch(GOOGLE_SCRIPT_URL, { credentials: 'omit' }); if (!response.ok) throw new Error('Error'); const data = await response.json(); const formattedSaldo = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(data.saldo); saldoDisplay.innerText = formattedSaldo; statusText.innerText = "Data Terbaru"; statusText.classList.add('text-green-400'); icon.classList.add('hidden'); } catch (error) { console.error("Gagal", error); statusText.innerText = "Gagal Sinkronisasi"; statusText.classList.remove('text-green-400'); statusText.classList.add('text-red-500'); } }
        function closeAuthError() { document.getElementById('auth-error-modal').classList.remove('active'); }
        function logoutFinance() { document.getElementById('finance-user').value = ''; document.getElementById('finance-pass').value = ''; document.getElementById('finance-dashboard').classList.add('hidden'); document.getElementById('finance-login').classList.remove('hidden'); document.getElementById('pass-error-msg').classList.add('hidden'); }

        /* --- UPDATED STRUCTURE LOGIC --- */
        async function loadStructureData() {
            try {
                const response = await fetch(STRUCTURE_SCRIPT_URL);
                const data = await response.json();
                if(data.meta && data.meta.password) SERVER_PASSWORD = data.meta.password;
                
                // Parse keys into semesterData structure
                Object.keys(data).forEach(fullKey => {
                    if (fullKey.startsWith("SEM_")) {
                        const parts = fullKey.split('_'); 
                        const sem = parts[1];
                        const key = parts.slice(2).join('_');
                        const arrayMatch = key.match(/(.*)_(\d+)$/);
                        let struct = getSemesterData(sem);
                        
                        if (arrayMatch) {
                            const realKey = arrayMatch[1];
                            const index = parseInt(arrayMatch[2]);
                            if (struct.executor[realKey] && Array.isArray(struct.executor[realKey])) {
                                struct.executor[realKey][index] = { name: data[fullKey].name, img: data[fullKey].img };
                            }
                        } else {
                            if (struct.main[key]) struct.main[key] = { name: data[fullKey].name, img: data[fullKey].img };
                            else if (struct.executor[key]) struct.executor[key] = { name: data[fullKey].name, img: data[fullKey].img };
                        }
                    }
                });
                
                if (currentSemesterIndex > 0) { updateStructureUI(semesterList[currentSemesterIndex]); }
            } catch (error) { console.error("Load failed:", error); }
        }

        function getSemesterData(sem) {
            if (!semesterData[sem]) {
                semesterData[sem] = { 
                    main: { ketua: { name: "", img: "" }, sek1: { name: "", img: "" }, sek2: { name: "", img: "" }, ben: { name: "", img: "" } },
                    executor: { koor: { name: "", img: "" }, div_kreatif: Array(6).fill({name: "", img: ""}), div_kebersihan: Array(5).fill({name: "", img: ""}), div_sosial: Array(6).fill({name: "", img: ""}) }
                };
            }
            return semesterData[sem];
        }

        function updateSemesterDisplay() { 
            const sem = semesterList[currentSemesterIndex]; 
            const teamExecutorBtn = document.getElementById('btn-team-executor');
            const displayEl = document.getElementById('current-semester-display');
            
            document.getElementById('btn-prev-sem').style.visibility = (currentSemesterIndex === 0) ? 'hidden' : 'visible';
            document.getElementById('btn-next-sem').style.visibility = (currentSemesterIndex === semesterList.length - 1) ? 'hidden' : 'visible';
            if(teamExecutorBtn) teamExecutorBtn.style.display = (currentSemesterIndex === 0) ? 'none' : 'block';

            displayEl.style.opacity = '0';
            setTimeout(() => {
                displayEl.innerText = `SEMESTER ${sem}`;
                displayEl.style.opacity = '1';
                updateStructureUI(sem); 
            }, 200);
        }

        function nextSemester() { if (currentSemesterIndex < semesterList.length - 1) { currentSemesterIndex++; updateSemesterDisplay(); } }
        function prevSemester() { if (currentSemesterIndex > 0) { currentSemesterIndex--; updateSemesterDisplay(); } }

        function updateStructureUI(sem) { 
            const container = document.getElementById('structure-content-container'); 
            if (sem === "I") {
                const data = { 
                    ketua: { name: "Ubaidillah M.", img: dbFoto["Ubaidillah M."] }, 
                    wakil: { name: "Pniel Munandar", img: dbFoto["Pniel Munandar"] }, 
                    sek1: { name: "Riska Ayu K.", img: dbFoto["Riska Ayu K."] }, 
                    sek2: { name: "Yoana Dian R.A.", img: dbFoto["Yoana Dian R.A."] }, 
                    ben1: { name: "Putri Dwi Astuti", img: dbFoto["Putri Dwi Astuti"] }, 
                    ben2: { name: "Anggun Lolyka H.", img: dbFoto["Anggun Lolyka H."] } 
                };
                container.innerHTML = `<div class="tree"><ul><li>${createStaticCard(data.ketua.img, data.ketua.name, "Ketua")}<ul><li>${createStaticCard(data.wakil.img, data.wakil.name, "Wakil")}<ul><li><div class="flex flex-col gap-2">${createStaticCard(data.sek1.img, data.sek1.name, "Sekretaris 1")}${createStaticCard(data.sek2.img, data.sek2.name, "Sekretaris 2")}</div></li><li><div class="flex flex-col gap-2">${createStaticCard(data.ben1.img, data.ben1.name, "Bendahara 1")}${createStaticCard(data.ben2.img, data.ben2.name, "Bendahara 2")}</div></li></ul></li></ul></li></ul></div>`; 
            } else {
                renderMainStructure(getSemesterData(sem).main);
            }
        }

        function renderMainStructure(dataMain) {
            const container = document.getElementById('structure-content-container');
            container.innerHTML = `<div class="tree"><ul><li>${createDynamicCard('ketua', "Ketua Kelas", dataMain.ketua)}<ul><li><div class="inline-block px-4 py-1 mb-4 rounded-full border border-blue-900/50 bg-blue-950/20 backdrop-blur text-blue-300 text-[10px] font-tech tracking-widest shadow-[0_0_15px_rgba(30,58,138,0.3)]">SEKRETARIS</div><br><div class="flex gap-2 justify-center">${createDynamicCard('sek1', "Sekretaris 1", dataMain.sek1)}${createDynamicCard('sek2', "Sekretaris 2", dataMain.sek2)}</div></li><li><div class="inline-block px-4 py-1 mb-4 rounded-full border border-emerald-900/50 bg-emerald-950/20 backdrop-blur text-emerald-300 text-[10px] font-tech tracking-widest shadow-[0_0_15px_rgba(6,78,59,0.3)]">BENDAHARA</div><br><div class="flex justify-center">${createDynamicCard('ben', "Bendahara", dataMain.ben)}</div></li></ul></li></ul></div>`;
        }

        function renderTeamExecutorTree(dataEx) {
            const container = document.getElementById('executor-tree-container');
            container.innerHTML = `<div class="tree w-full"><ul><li>${createDynamicCard('koor', "Koordinator", dataEx.koor, 'executor')}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-8 w-full">
                    <div class="flex flex-col items-center">
                        <div class="glass-panel px-3 py-2 rounded-lg border border-orange-500/30 mb-4 inline-block bg-orange-950/20"><h5 class="text-orange-400 font-bold text-[10px] md:text-xs whitespace-nowrap font-tech tracking-wider"><i class="fas fa-paint-brush mr-1"></i> KREATIF</h5></div>
                        <div class="grid grid-cols-1 gap-1 justify-items-center">${dataEx.div_kreatif.map((m, i) => createDynamicCard('div_kreatif', `Staff ${i+1}`, m, 'executor', i)).join('')}</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="glass-panel px-3 py-2 rounded-lg border border-red-500/30 mb-4 inline-block bg-red-950/20"><h5 class="text-red-400 font-bold text-[10px] md:text-xs whitespace-nowrap font-tech tracking-wider"><i class="fas fa-broom mr-1"></i> KEBERSIHAN</h5></div>
                        <div class="grid grid-cols-1 gap-1 justify-items-center">${dataEx.div_kebersihan.map((m, i) => createDynamicCard('div_kebersihan', `Staff ${i+1}`, m, 'executor', i)).join('')}</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="glass-panel px-3 py-2 rounded-lg border border-yellow-500/30 mb-4 inline-block bg-yellow-950/20"><h5 class="text-yellow-400 font-bold text-[10px] md:text-xs whitespace-nowrap font-tech tracking-wider"><i class="fas fa-heart mr-1"></i> SOSIAL</h5></div>
                        <div class="grid grid-cols-1 gap-1 justify-items-center">${dataEx.div_sosial.map((m, i) => createDynamicCard('div_sosial', `Staff ${i+1}`, m, 'executor', i)).join('')}</div>
                    </div>
                </div>
            </li></ul></div>`;
        }

        function createStaticCard(img, name, role) { 
            return `<div class="glass-panel p-2 rounded-xl inline-block w-28 md:w-40 mx-1 mb-2"><div class="w-12 h-12 md:w-16 md:h-16 mx-auto rounded-full mb-2 overflow-hidden border-2 border-red-500 bg-gray-800"><img src="${img}" class="w-full h-full object-cover"></div><h3 class="font-bold text-white text-[10px] md:text-xs leading-tight mb-1">${name}</h3><p class="text-[8px] text-gray-400 uppercase tracking-widest">${role}</p></div>`; 
        }

        function createDynamicCard(key, label, data, type = 'main', index = null) {
            const name = data?.name || "";
            const img = name ? (data.img || dbFoto[name] || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=300505&color=ffffff`) : "";
            const params = `'${type}', '${key}'${index !== null ? `, ${index}` : ''}`;

            if (!name) return `<div class="glass-panel empty-slot p-3 rounded-xl inline-flex flex-col items-center justify-center w-24 md:w-36 h-32 md:h-44 cursor-pointer mx-1 mb-2 group transition-all duration-300" onclick="openEditModal(${params})"><div class="w-10 h-10 md:w-14 md:h-14 rounded-full mb-2 flex items-center justify-center border border-dashed border-gray-600 text-gray-600 group-hover:text-red-500 group-hover:border-red-500 group-hover:scale-110 transition-all bg-black/40"><i class="fas fa-plus"></i></div><span class="text-[10px] text-gray-600 group-hover:text-red-400 transition-colors">Isi Data</span><p class="text-[8px] text-gray-700 uppercase mt-1 font-tech">${label}</p></div>`;

            return `<div class="glass-panel p-3 rounded-xl inline-flex flex-col items-center justify-center w-24 md:w-36 h-auto min-h-[128px] md:min-h-[192px] cursor-pointer mx-1 mb-2 group hover:z-50" onclick="openEditModal(${params})"><div class="relative w-12 h-12 md:w-20 md:h-20 mb-3"><div class="absolute inset-0 bg-red-600 blur-lg opacity-20 rounded-full group-hover:opacity-40 transition-opacity"></div><img src="${img}" class="w-full h-full object-cover rounded-full border-2 border-gray-600 group-hover:border-red-500 shadow-lg avatar-glow relative z-10 bg-[#1a0505]"></div><h3 class="font-bold text-white text-[10px] md:text-xs leading-tight break-words w-full px-1 mb-1 group-hover:text-red-200 transition-colors">${name}</h3><div class="h-[1px] w-8 bg-red-900/50 mx-auto my-1"></div><p class="text-[8px] text-red-400 uppercase font-tech">${label}</p></div>`;
        }

        /* --- EDIT & PASSWORD LOGIC --- */
        function initiateAction(action) {
            pendingAction = action;
            document.getElementById('password-error').classList.add('hidden');
            document.getElementById('admin-password').value = '';
            document.getElementById('edit-modal').classList.remove('active');
            
            setTimeout(() => {
                document.getElementById('password-modal').classList.add('active');
                document.getElementById('admin-password').focus();
            }, 200);
        }

        function closePasswordModal() {
            document.getElementById('password-modal').classList.remove('active');
            pendingAction = null;
        }

        function confirmAction() {
            const password = document.getElementById('admin-password').value;
            const errorLabel = document.getElementById('password-error');

            if(SERVER_PASSWORD && password !== SERVER_PASSWORD) {
                errorLabel.classList.remove('hidden');
                return; 
            }

            errorLabel.classList.add('hidden');
            document.getElementById('password-modal').classList.remove('active');
            
            if(pendingAction === 'save') saveMember(false);
            else if (pendingAction === 'delete') saveMember(true);
        }

        function openEditModal(type, key, index = null) {
            currentEditTarget = { type, key, index };
            const data = getSemesterData(semesterList[currentSemesterIndex]);
            let target = (type === 'main') ? data.main[key] : (index !== null ? data.executor[key][index] : data.executor[key]);
            
            const modal = document.getElementById('edit-modal');
            const form = document.getElementById('edit-form-container');
            const preview = document.getElementById('preview-container');

            modal.classList.add('active');
            if (target && target.name) {
                form.classList.add('hidden');
                preview.classList.remove('hidden');
                preview.classList.add('flex');
                document.getElementById('preview-img').src = target.img || dbFoto[target.name] || "";
                document.getElementById('preview-name').innerText = target.name;
            } else {
                form.classList.remove('hidden');
                preview.classList.add('hidden');
                document.getElementById('input-name').value = "";
                setTimeout(() => document.getElementById('input-name').focus(), 100);
            }
        }

        function closeEditModal() { document.getElementById('edit-modal').classList.remove('active'); currentEditTarget = null; }

        async function saveMember(isClear = false) {
            if (!currentEditTarget) return;
            const input = document.getElementById('input-name');
            const newName = isClear ? "" : input.value.trim();
            const { type, key, index } = currentEditTarget;
            
            let newImg = isClear ? "" : (dbFoto[newName] || `https://ui-avatars.com/api/?name=${encodeURIComponent(newName)}&background=300505&color=ffffff&bold=true`);
            const sem = semesterList[currentSemesterIndex];
            const data = getSemesterData(sem);
            const newData = { name: newName, img: newImg };

            // Update UI Lokal
            if (type === 'main') {
                data.main[key] = newData;
                updateStructureUI(sem);
            } else {
                if (index !== null) data.executor[key][index] = newData;
                else data.executor[key] = newData;
                if(document.getElementById('team-executor-modal').classList.contains('open')) {
                    renderTeamExecutorTree(data.executor);
                }
            }

            // Sync ke Server
            let serverKey = `SEM_${sem}_${key}`;
            if (index !== null) serverKey += `_${index}`;

            try {
                await fetch(STRUCTURE_SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors', 
                    body: JSON.stringify({ key: serverKey, name: newData.name, img: newData.img })
                });
            } catch (e) { console.error("Sync Error:", e); }
            
            input.value = "";
            currentEditTarget = null;
            closeEditModal();
        }

        function toggleTeamExecutor() { 
            const m = document.getElementById('team-executor-modal');
            if(m.classList.contains('open')) { m.classList.remove('open'); document.body.style.overflow = 'auto'; }
            else { 
                renderTeamExecutorTree(getSemesterData(semesterList[currentSemesterIndex]).executor); 
                m.classList.add('open'); 
                document.body.style.overflow = 'hidden'; 
            }
        }

        /* --- STANDARD FUNCTIONS --- */
        function generateStudents() { 
            let h = ''; studentsData.forEach((s, i) => { h += `<div onclick="openBioModal(${i})" class="cursor-pointer group"><div class="relative rounded-xl aspect-square overflow-hidden bg-gray-900 border-2 border-transparent group-hover:border-red-500"><div class="img-loading-skeleton z-0"><i class="fas fa-spinner fa-spin text-red-900 text-2xl"></i></div><img src="${s.img}" class="relative z-10 w-full h-full object-cover opacity-0 group-hover:scale-110 transition-all duration-500" onload="this.classList.replace('opacity-0', 'opacity-100')" onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(s.name)}&background=random&size=200'; this.classList.replace('opacity-0', 'opacity-100');"><div class="absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black via-black/80 to-transparent z-20"><p class="text-white font-bold text-xs truncate group-hover:text-red-400 transition-colors">${s.name}</p></div></div></div>`; });
            document.getElementById('student-grid').innerHTML = h;
        }
        function initDocumentation() { renderMainDocGrid(); }
        function handleSearch(event) { const query = document.getElementById('doc-search').value; if (query.length > 0) { if (!history.state || history.state.page !== 'doc-search') { history.pushState({ page: 'doc-search' }, '', '#search'); } } if (event.key === 'Enter' || event.type === 'click' || event.type === 'keyup') { renderMainDocGrid(query); } }
        function openAllFiles() { renderAllFilesGrid(); const modal = document.getElementById('all-files-overlay'); modal.classList.add('open'); document.body.style.overflow = 'hidden'; history.pushState({ page: 'all-files' }, '', '#all-files'); modal.focus(); }
        function closeAllFiles() { if (history.state && history.state.page === 'all-files') { history.back(); return; } const modal = document.getElementById('all-files-overlay'); modal.classList.remove('open'); document.body.style.overflow = 'auto'; history.replaceState({ page: 'documentation' }, '', '#documentation'); }
        function toggleFamilyGallery() { const gallery = document.getElementById('family-gallery'); if (gallery.classList.contains('open')) { if (history.state && history.state.page === 'family-gallery') { history.back(); return; } gallery.classList.remove('open'); document.body.style.overflow = 'auto'; } else { gallery.classList.add('open'); document.body.style.overflow = 'hidden'; history.pushState({ page: 'family-gallery' }, '', '#family'); gallery.focus(); } }
        function openBioModal(index) { const student = studentsData[index]; const modal = document.getElementById('bio-modal'); const content = document.getElementById('bio-content'); document.getElementById('modal-name').innerText = student.name; document.getElementById('modal-nim').innerText = "NIM: " + student.nim; const igContainer = document.getElementById('modal-ig'); if(student.ig === '-' || student.ig === '') { igContainer.innerHTML = `<span class="text-gray-500">-</span>`; } else { const username = student.ig.replace('@', '').trim(); igContainer.innerHTML = `<a href="https://www.instagram.com/${username}" target="_blank" rel="noopener noreferrer" class="text-lg text-white font-medium hover:text-red-400 transition cursor-pointer flex items-center gap-1">${student.ig} <i class="fas fa-external-link-alt text-xs ml-1 opacity-50"></i></a>`; } document.getElementById('modal-bio').innerText = `"${student.bio}"`; const imgElement = document.getElementById('modal-img'); const loaderElement = document.getElementById('modal-img-loader'); imgElement.classList.remove('img-loaded'); imgElement.style.opacity = '0'; loaderElement.style.display = 'flex'; imgElement.onload = function() { imgElement.style.opacity = '1'; loaderElement.style.display = 'none'; }; imgElement.onerror = function() { this.onerror = null; this.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(student.name)}&background=random&size=400`; imgElement.style.opacity = '1'; loaderElement.style.display = 'none'; }; imgElement.src = student.bioImg; modal.classList.add('active'); content.classList.remove('scale-95'); content.classList.add('scale-100'); history.pushState({ page: 'bio-details' }, '', '#student-bio'); setTimeout(() => { content.focus(); }, 100); }
        function closeBioModal(e, force = false) { if (e && !force) { const content = document.getElementById('bio-content'); if (content.contains(e.target)) return; } if (history.state && history.state.page === 'bio-details') { history.back(); return; } document.getElementById('bio-modal').classList.remove('active'); }
        function openMediaModal(type, src) { if(!src) return; if (type === 'video') { const bgMusic = document.getElementById('bg-music'); if (bgMusic && !bgMusic.paused) { bgMusic.pause(); bgMusic.dataset.wasPlaying = "true"; } } const modal = document.getElementById('media-modal'); const container = document.getElementById('media-container'); if (type === 'video') { container.innerHTML = ` <div class="bg-black w-full h-full flex items-center justify-center"> <video controls autoplay class="w-full h-auto max-h-[85vh]"> <source src="${src}" type="video/mp4"> Your browser does not support the video tag. </video> </div>`; container.dataset.mediaType = 'video'; } else { container.innerHTML = ` <img src="${src}" class="w-full h-auto max-h-[85vh] object-contain bg-black" onerror="this.src='https://placehold.co/600x400?text=Image+Not+Found';"> `; container.dataset.mediaType = 'image'; } modal.classList.add('active'); history.pushState({ page: 'media-preview' }, '', '#preview'); }
        function closeMediaModal(e, force = false) { if (e && !force) { const container = document.getElementById('media-container'); if (container.contains(e.target)) return; } if (history.state && history.state.page === 'media-preview') { history.back(); return; } const container = document.getElementById('media-container'); if (container.dataset.mediaType === 'video') { const bgMusic = document.getElementById('bg-music'); const musicBtn = document.getElementById('music-btn'); if (bgMusic && bgMusic.dataset.wasPlaying === "true") { bgMusic.play().catch(e => console.log(e)); if(musicBtn) { musicBtn.innerHTML = '<i class="fas fa-music"></i>'; musicBtn.classList.add('music-pulse'); isPlaying = true; } } } container.innerHTML = ''; document.getElementById('media-modal').classList.remove('active'); }
        function previewVideo(video) { video.muted = true; var playPromise = video.play(); if (playPromise !== undefined) { playPromise.then(_ => {}).catch(error => { if (error.name !== 'AbortError') console.log("Prev prevented"); }); } }
        function stopPreview(video) { video.pause(); video.currentTime = 0; }
        function renderMainDocGrid(filter = "") { const container = document.getElementById('documentation-grid'); let html = ''; let itemsToShow = filter ? allFilesData : existingMedia; itemsToShow.forEach(item => { if (filter && !item.title.toLowerCase().includes(filter.toLowerCase())) return; html += createMediaCard(item); }); if(html === '') { html = `<div class="col-span-3 text-center text-gray-500 py-10">No media found matching "${filter}"</div>`; } container.innerHTML = html; }
        function renderAllFilesGrid() { const container = document.getElementById('all-files-grid'); let html = ''; allFilesData.forEach(item => { html += createMediaCard(item, true); }); container.innerHTML = html; }
        function createMediaCard(item, isSmall = false) { const margin = isSmall ? 'mb-4' : 'mb-6'; const isLogo = item.ratio === 'aspect-square' && item.title.toLowerCase().includes('logo'); const shapeClass = isLogo ? `rounded-full aspect-square border-4 border-red-600/30 shadow-[0_0_25px_rgba(220,38,38,0.4)]` : `rounded-xl ${item.ratio}`; const textPosition = isLogo ? 'inset-0 flex items-end justify-center pb-6' : 'bottom-4 left-4'; if (item.type === 'video') { return ` <div class="break-inside-avoid relative group ${shapeClass} overflow-hidden glass-panel cursor-pointer ${margin}" onclick="openMediaModal('video', '${item.src}')"> <div class="w-full h-full bg-black/50 flex items-center justify-center"> ${item.src ? `<video class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-500" loop muted onmouseenter="previewVideo(this)" onmouseleave="stopPreview(this)"> <source src="${item.src}" type="video/mp4"> </video>` : `<i class="fas fa-video text-gray-600 text-4xl"></i>` } </div> <div class="play-overlay"><i class="fas fa-play"></i></div> <div class="absolute z-10 ${textPosition}"> <span class="text-xs font-bold text-white bg-red-600 px-2 py-1 rounded shadow-lg">${item.title}</span> </div> </div>`; } else { return ` <div class="break-inside-avoid relative group ${shapeClass} overflow-hidden glass-panel cursor-pointer ${margin}" onclick="openMediaModal('image', '${item.src}')"> <img src="${item.src}" alt="${item.title}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" onerror="this.src='https://placehold.co/600x800/1a0505/FFF?text=No+Image';"> <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-80"></div> <div class="absolute ${textPosition}"> <h3 class="text-lg font-bold text-white drop-shadow-md">${item.title}</h3> </div> </div>`; } }
        
        window.addEventListener('popstate', function(event) {
            const state = event.state || { page: 'home' };
            const bioModal = document.getElementById('bio-modal');
            const mediaModal = document.getElementById('media-modal');
            const familyGallery = document.getElementById('family-gallery');
            const allFilesModal = document.getElementById('all-files-overlay');
            const mediaContainer = document.getElementById('media-container');
            const teamExecutorModal = document.getElementById('team-executor-modal');
            
            bioModal.classList.remove('active');
            mediaModal.classList.remove('active');
            familyGallery.classList.remove('open');
            allFilesModal.classList.remove('open');
            teamExecutorModal.classList.remove('open');
            mediaContainer.innerHTML = '';
            document.body.style.overflow = 'auto';

            if (state.page === 'documentation' || state.page === 'home') {
                 const searchInput = document.getElementById('doc-search');
                 if(searchInput.value !== '') { searchInput.value = ''; renderMainDocGrid(''); }
            }
            if (['home', 'structure', 'documentation', 'finance'].includes(state.page)) { _switchTabUI(state.page); } 
            else if (state.page === 'family-gallery') { familyGallery.classList.add('open'); document.body.style.overflow = 'hidden'; } 
            else if (state.page === 'all-files') { allFilesModal.classList.add('open'); document.body.style.overflow = 'hidden'; } 
            else if (state.page === 'team-executor') { teamExecutorModal.classList.add('open'); document.body.style.overflow = 'hidden'; } 
            else if (state.page === 'bio-details') { familyGallery.classList.add('open'); document.body.style.overflow = 'hidden'; }
        });
    </script>
</body>
</html>
